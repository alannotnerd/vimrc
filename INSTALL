#!/usr/bin/env python3

from subprocess import run, check_output
from os import path, listdir, getcwd
from shutil import which

def path_of(file):
    return path.join(path.dirname(__file__), file)

def os_name():
    out = str(check_output(["hostnamectl"]), encoding="utf-8")
    if out.find("Arch Linux"):
        return "arch"
    return "unknown"

def install_zsh():
    os = os_name()
    if os == "arch":
        run(["yay", "-Sy", "zsh"])

def bin_exists(bin):
    out = which("zsh")
    return out

# create nvim symbol link
print("Configure nvim")
if not path.exists(path.expandvars("$HOME/.config/nvim")):
    run(["ln", "-s", path_of("nvim"), path.expandvars("$HOME/.config/nvim")])

# create tools symbol link
print("Configure tools")
tools_path = path_of("tools")
for tool in listdir(tools_path):
    if path.exists(path.expandvars(f"$HOME/.local/bin/{tool}")):
        continue
    print(f"Create symbol link for {tool} to ~/.local/bin/{tool}")
    run(["ln", "-s", path.join(tools_path, tool), path.expandvars(f"$HOME/.local/bin/{tool}")])

print("Configure zsh")
if not bin_exists("zsh"):
    install_zsh()

zshrc_path = path.expandvars("$HOME/.zshrc")
if not path.exists(zshrc_path):
    run(["ln", "-s", path_of("zsh/init.zsh"), zshrc_path])
